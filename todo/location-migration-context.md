# –ö–æ–Ω—Ç–µ–∫—Å—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ª–æ–∫–∞—Ü–∏–π

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ: SmartLocationFilter –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ä—Ç—ã

### –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–§–∞–π–ª:** `kaliningrad-land/src/components/filters/SmartLocationFilter.tsx`

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Ñ–∏–ª—å—Ç—Ä–∞ –ª–æ–∫–∞—Ü–∏–π —Å:

1. **–°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞** ‚Äî –∂–∏–≤–æ–π –ø–æ–∏—Å–∫ –ø–æ API `/api/locations/search`
   - Debounce 300ms
   - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–∏–ø (–≥–æ—Ä–æ–¥/—Ä–∞–π–æ–Ω/–Ω.–ø.) –∏ –∏–µ—Ä–∞—Ä—Ö–∏—é
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: `sort_order DESC` ‚Üí —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å ‚Üí –∞–ª—Ñ–∞–≤–∏—Ç

2. **–ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ** ‚Äî –≤—ã–±–æ—Ä —Ä–∞–π–æ–Ω–∞/–≥–æ—Ä–æ–¥–∞ –∏–∑ —Å–ø–∏—Å–∫–∞
   - 3 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ (`sm:!max-w-6xl`)
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: `sort_order DESC` ‚Üí –∞–ª—Ñ–∞–≤–∏—Ç
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ª–æ–∫–∞—Ü–∏–π –±–µ–∑ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (`min_listings=1`)
   - –ò–∫–æ–Ω–∫–∏: üèôÔ∏è –≥–æ—Ä–æ–¥–∞, üìç —Ä–∞–π–æ–Ω—ã

3. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å URL**
   - –ü—Ä–∏ –≤—ã–±–æ—Ä–µ –ª–æ–∫–∞—Ü–∏–∏ ‚Üí `router.push(/map?location_id=X)`
   - –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ `location_id` –≤ URL

### –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤

- `components/map/MapFilters.tsx` ‚Äî –ø–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ –Ω–∞ `/map`

### Backend API

- `GET /api/locations/search?q=...&min_listings=1` ‚Äî –ø–æ–∏—Å–∫
- `GET /api/locations/hierarchy/` ‚Äî –∏–µ—Ä–∞—Ä—Ö–∏—è —Å `sort_order`
- `PATCH /api/admin/locations/{id}` ‚Äî —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `sort_order`

---

## üî≤ TODO: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≥–ª–∞–≤–Ω–æ–π –∏ –∫–∞—Ç–∞–ª–æ–≥–∞

### –¶–µ–ª—å

–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö, –∏—Å–ø–æ–ª—å–∑—É—è `SmartLocationFilter`.

### –°—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞

1. **–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** (`/`) ‚Äî `src/app/page.tsx` –∏–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Hero
2. **–ö–∞—Ç–∞–ª–æ–≥** (`/catalog`) ‚Äî `src/components/catalog/CatalogFilters.tsx`

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

#### 1. –°—Ç—Ä–æ–∫–∞ –ø–æ–∏—Å–∫–∞
- –î–æ–±–∞–≤–∏—Ç—å `SmartLocationFilter` –≤–º–µ—Å—Ç–æ —Ç–µ–∫—É—â–∏—Ö dropdown'–æ–≤
- –°–æ—Ö—Ä–∞–Ω–∏—Ç—å placeholder "–†–∞–π–æ–Ω –∏–ª–∏ –≥–æ—Ä–æ–¥"

#### 2. –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
- –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–†–∞–π–æ–Ω" ‚Äî –æ—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
- 3-–∫–æ–ª–æ–Ω–æ—á–Ω–∞—è —Å–µ—Ç–∫–∞ –≥–æ—Ä–æ–¥–æ–≤/—Ä–∞–π–æ–Ω–æ–≤
- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ `sort_order` (–±–æ–ª—å—à–µ = –≤—ã—à–µ)

#### 3. –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ –≥–µ–æ-URL
- –ü—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ —Å—Å—ã–ª–∫–µ –≤–∏–¥–∞ `/zelenogradskij-r-n/svetlogorsk`
- –§–∏–ª—å—Ç—Ä –¥–æ–ª–∂–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ª–æ–∫–∞—Ü–∏–µ–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API `/api/locations/resolve-v2?slugs=...`

### –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è

```
kaliningrad-land/
‚îú‚îÄ‚îÄ src/app/page.tsx                      # –ì–ª–∞–≤–Ω–∞—è
‚îú‚îÄ‚îÄ src/app/catalog/page.tsx              # –ö–∞—Ç–∞–ª–æ–≥ (SSR)
‚îú‚îÄ‚îÄ src/components/catalog/
‚îÇ   ‚îú‚îÄ‚îÄ CatalogFilters.tsx                # –¢–µ–∫—É—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞
‚îÇ   ‚îî‚îÄ‚îÄ CatalogClient.tsx                 # –ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è —á–∞—Å—Ç—å
‚îú‚îÄ‚îÄ src/components/filters/
‚îÇ   ‚îî‚îÄ‚îÄ SmartLocationFilter.tsx           # ‚úÖ –ì–æ—Ç–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îî‚îÄ‚îÄ src/components/map/
    ‚îî‚îÄ‚îÄ MapFilters.tsx                    # ‚úÖ –ü—Ä–∏–º–µ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
```

### –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

1. [ ] –ò–∑—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é `CatalogFilters.tsx`
2. [ ] –ó–∞–º–µ–Ω–∏—Ç—å dropdown –ª–æ–∫–∞—Ü–∏–π –Ω–∞ `SmartLocationFilter`
3. [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –ø–æ –≥–µ–æ-URL
4. [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥—ã `/catalog` ‚Üî `/map` ‚Üî `/listing/[slug]`
5. [ ] –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–ª—è –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –≥–µ–æ-URL

–¢–µ–∫—É—â–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:
- `/catalog` ‚Äî –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞
- `/{district-slug}` ‚Äî —Ä–∞–π–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä `/zelenogradskij-r-n`)
- `/{district-slug}/{settlement-slug}` ‚Äî –Ω.–ø. (–Ω–∞–ø—Ä–∏–º–µ—Ä `/zelenogradskij-r-n/svetlogorsk`)

–ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –≥–µ–æ-URL:
1. –í—ã–∑–≤–∞—Ç—å `/api/locations/resolve-v2?slugs=zelenogradskij-r-n,svetlogorsk`
2. –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä–µ–∫—Ç –ª–æ–∫–∞—Ü–∏–∏
3. –ü–µ—Ä–µ–¥–∞—Ç—å –≤ `SmartLocationFilter` –∫–∞–∫ –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ `value`

### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è SmartLocationFilter

```tsx
import { SmartLocationFilter, SmartSelectedLocation } from "@/components/filters/SmartLocationFilter";

const [selectedLocation, setSelectedLocation] = useState<SmartSelectedLocation | null>(null);

// –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å –≥–µ–æ-URL
useEffect(() => {
  if (slugsFromUrl) {
    fetch(`/api/locations/resolve-v2?slugs=${slugsFromUrl}`)
      .then(res => res.json())
      .then(data => setSelectedLocation(data.location));
  }
}, [slugsFromUrl]);

// –í JSX
<SmartLocationFilter
  value={selectedLocation}
  onChange={handleLocationChange}
  placeholder="–†–∞–π–æ–Ω –∏–ª–∏ –≥–æ—Ä–æ–¥"
/>
```
