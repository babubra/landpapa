# üöö –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ü–µ—Ä–µ–µ–∑–¥ –Ω–∞ –Ω–æ–≤—É—é –∞–¥—Ä–µ—Å–Ω—É—é —Å–∏—Å—Ç–µ–º—É (locations)

–≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ (–∏–ª–∏ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è) –Ω–∞ –Ω–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Ö—Ä–∞–Ω–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–π.

## ‚ö†Ô∏è 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –ë—ç–∫–∞–ø (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û)
–ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç —Å–¥–µ–ª–∞–π—Ç–µ –ø–æ–ª–Ω—ã–π –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö.
```bash
pg_dump -U postgres -d kaliningrad_land > pre_migration_backup.sql
```

## 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞
–ó–∞–±–µ—Ä–∏—Ç–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
```bash
git pull origin main
```
–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –ø–∞–ø–∫–µ `backend` –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–æ.

## 3. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π (Alembic)
–°–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (`locations`) –∏ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–ª–æ–Ω–∫–∏ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ.
```bash
cd backend
# Windows
venv\Scripts\alembic upgrade head
# Linux/Mac
./venv/bin/alembic upgrade head
```

## 4. –ó–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
–°–∫—Ä–∏–ø—Ç `migrate_full.py` –ø–µ—Ä–µ–Ω–µ—Å–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü (`districts`, `settlements`) –≤ –Ω–æ–≤—É—é (`locations`), —Å–æ—Ö—Ä–∞–Ω—è—è —Å–≤—è–∑–∏ –∏ URL-–∞–¥—Ä–µ—Å–∞.

```bash
# Windows
venv\Scripts\python.exe -m app.scripts.migrate_full

# Linux/Mac
./venv/bin/python -m app.scripts.migrate_full
```

### –ß—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
1. **–ü—Ä–æ–≤–µ—Ä—è–µ—Ç/–°–æ–∑–¥–∞–µ—Ç "–†–µ–≥–∏–æ–Ω"** (–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å).
2. **–ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –†–∞–π–æ–Ω—ã**:
   - –°–æ–∑–¥–∞–µ—Ç –∑–∞–ø–∏—Å–∏ –≤ `locations` (type=DISTRICT).
   - **–í–∞–∂–Ω–æ:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Ç–∞—Ä—ã–µ `slug` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `gur-evskij-r-n` –≤–º–µ—Å—Ç–æ `gurevskij-r-n`), —á—Ç–æ–±—ã –Ω–µ —Å–ª–æ–º–∞—Ç—å SEO-—Å—Å—ã–ª–∫–∏.
3. **–ü–µ—Ä–µ–Ω–æ—Å–∏—Ç –ü–æ—Å–µ–ª–∫–∏**:
   - –ú–∞–ø–ø–∏—Ç –∏—Ö –∫ –Ω–æ–≤—ã–º —Ä–∞–π–æ–Ω–∞–º.
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **FIAS ID** –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
   - **–°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞:**
     - `–ü–∏–æ–Ω–µ—Ä—Å–∫–∏–π` –∏ `–Ø–Ω—Ç–∞—Ä–Ω—ã–π` —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è –≥–æ—Ä–æ–¥–∞–º–∏ –æ–±–ª–∞—Å—Ç–Ω–æ–≥–æ –ø–æ–¥—á–∏–Ω–µ–Ω–∏—è (`type=CITY`, parent=Region).
     - `–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥` –º–∞–ø–ø–∏—Ç—Å—è –∫–∞–∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –≥–æ—Ä–æ–¥.
     - `–ü–æ–∫—Ä–æ–≤—Å–∫–æ–µ` –∏ `–°–∏–Ω—è–≤–∏–Ω–æ` –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è "–ø–æ–¥" –Ø–Ω—Ç–∞—Ä–Ω—ã–π.
4. **–û–±–Ω–æ–≤–ª—è–µ—Ç –û–±—ä—è–≤–ª–µ–Ω–∏—è**:
   - –ü—Ä–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü–µ `listings` –Ω–æ–≤–æ–µ –ø–æ–ª–µ `location_id` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å—Ç–∞—Ä–æ–≥–æ `settlement_id`.

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞
1. –ó–∞–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É –∏–ª–∏ –ë–î.
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—É `locations` ‚Äî —Ç–∞–º –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏ —Ä–∞–π–æ–Ω—ã, –∏ –ø–æ—Å–µ–ª–∫–∏.
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª—é–±–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ ‚Äî —É –Ω–µ–≥–æ –¥–æ–ª–∂–Ω–µ–Ω –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω `location_id`.

## 6. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) Seed –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
–ï—Å–ª–∏ –≤—ã —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç–µ **—á–∏—Å—Ç—É—é –±–∞–∑—É —Å –Ω—É–ª—è**, –≤–º–µ—Å—Ç–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ seed:
```bash
python -m app.seed
```
*–í `seed.py` —É–∂–µ –≤–Ω–µ—Å–µ–Ω—ã –ø—Ä–∞–≤–∫–∏ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è slugs –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.*
